dailex:
  infrastructure:
    logger:
      class: Dailex\Service\LoggingService
      provisioner:
        class: Dailex\Service\Provisioner\MonologServiceProvisioner
        settings:
          location: ${app.log_dir}/dailex.log
          alias: Psr\Log\LoggerInterface
      subscriptions:
        logging_sub:
          channel: logging
          transport: inproc

    controllers:
      class: Silex\ControllerCollection
      provisioner:
        class: Dailex\Service\Provisioner\ControllerProvisioner

    message_bus:
      class: Daikon\MessageBus\MessageBus
      provisioner:
        class: Dailex\Service\Provisioner\MessageBusProvisioner
        settings:
          transports:
            inproc:
              class: Daikon\MessageBus\Channel\Subscription\Transport\InProcessTransport
            message_queue:
              class: Daikon\RabbitMq3\Transport\RabbitMq3Transport
              dependencies:
                connector: dailex.message_queue

    crate_map:
      class: Dailex\Crate\CrateMap
      provisioner:
        class: Dailex\Service\Provisioner\CrateMapProvisioner

    connector_map:
      class: Daikon\Dbal\Connector\ConnectorMap
      provisioner:
        class: Dailex\Service\Provisioner\ConnectorMapProvisioner

    storage_adapter_map:
      class: Daikon\Dbal\Storage\StorageAdapterMap
      provisioner:
        class: Dailex\Service\Provisioner\StorageAdapterMapProvisioner

    stream_store_map:
      class: Daikon\EventSourcing\EventStore\StreamStoreMap
      provisioner:
        class: Dailex\Service\Provisioner\StreamStoreMapProvisioner

    unit_of_work_map:
      class: Daikon\EventSourcing\EventStore\UnitOfWorkMap
      provisioner:
        class: Dailex\Service\Provisioner\UnitOfWorkMapProvisioner

    repository_map:
      class: Daikon\ReadModel\Repository\RepositoryMap
      provisioner:
        class: Dailex\Service\Provisioner\RepositoryMapProvisioner

    projector_map:
      class: Daikon\ReadModel\Projector\ProjectorMap
      provisioner:
        class: Dailex\Service\Provisioner\ProjectorMapProvisioner

    projector_service:
      class: Daikon\ReadModel\Projector\ProjectorService
      subscriptions:
        commits_sub:
          channel: commits
          transport: inproc

    relation_projector_service:
      class: Daikon\ReadModel\Projector\RelationProjectorService
      subscriptions:
        events_sub:
          channel: events
          transport: message_queue
          enrichers:
            - class: Daikon\AsyncJob\Metadata\JobMetadataEnricher
              settings:
                job: dailex.message.distributor

    migration_target_map:
      class: Dailex\Infrastructure\Migration\MigrationTargetMap
      provisioner:
        class: Dailex\Service\Provisioner\MigrationTargetMapProvisioner

    job_map:
      class: Daikon\AsyncJob\Job\JobMap
      provisioner:
        class: Dailex\Service\Provisioner\JobMapProvisioner

    command_router:
      class: Dailex\Service\CommandRouter
      subscriptions:
        command_sub:
          channel: commands
          transport: inproc

    template_renderer:
      class: Dailex\Renderer\Twig\TwigRenderer
      provisioner:
        class: Dailex\Service\Provisioner\TwigRendererProvisioner
        settings:
          extensions:
            - Dailex\Renderer\Twig\Extension\ProjectExtension
            - Dailex\Renderer\Twig\Extension\LocaliseRouteExtension

    url_generator:
      class: Symfony\Component\Routing\Generator\UrlGenerator
      provisioner:
        class: Dailex\Service\Provisioner\SilexServiceProvisioner
        settings:
          app_key: url_generator
          alias: Symfony\Component\Routing\Generator\UrlGeneratorInterface